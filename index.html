<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–∞–≥–∞–∑–∏–Ω –ú–∞–∫—Å–∞–ª–∏–Ω–∞</title>

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json" />

  <!-- –ò–∫–æ–Ω–∫–∞ -->
  <link rel="icon" href="icon.png" type="image/png" />

  <!-- –°—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="style.css" />

  <!-- PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log("Service Worker –ø–æ–¥–∫–ª—é—á–µ–Ω"))
        .catch(err => console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Service Worker:", err));
    }
  </script>
</head>
<body>
  <header>
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω –ú–∞–∫—Å–∞–ª–∏–Ω–∞</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤.</p>
  </header>

  <!-- –°–µ–∫—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ -->
  <nav id="catalogSection">
    <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
    <select id="categorySelect">
      <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
    </select>

    <h2>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
    <select id="subcategorySelect" disabled>
      <option value="">–í—Å–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
    </select>

    <main>
      <div id="products">
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>
      </div>
    </main>
  </nav>

  <!-- –°–µ–∫—Ü–∏—è "–û –Ω–∞—Å" (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
  <section id="contentAbout" style="display:none; padding: 15px;">
    <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
    <p>üìû WhatsApp: <a href="https://wa.me/79161234567" target="_blank">+7 916 123-45-67</a></p>
    <p>üìß Email: <a href="mailto:info@maksalina.ru">info@maksalina.ru</a></p>
    <p>üìç –ê–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 10</p>
    <p>&copy; 2025 –ú–∞–≥–∞–∑–∏–Ω –ú–∞–∫—Å–∞–ª–∏–Ω–∞</p>
  </section>

  <!-- –ú–µ–Ω—é —Å –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏ -->
  <nav id="bottomMenu" style="position: fixed; bottom: 0; left: 0; right: 0; background:#f5f5f5; border-top:1px solid #ccc; display:flex; justify-content: space-around; padding:10px 0;">
    <button id="btnCatalog" style="flex:1; background:#8e44ad; color:#fff; border:none; padding:10px; font-weight:bold; cursor:pointer;">–ö–∞—Ç–∞–ª–æ–≥</button>
    <button id="btnAbout" style="flex:1; background:#ddd; border:none; padding:10px; font-weight:bold; cursor:pointer;">–û –Ω–∞—Å</button>
  </nav>

  <script>
    // –ö–Ω–æ–ø–∫–∏ –∏ —Å–µ–∫—Ü–∏–∏
    const btnCatalog = document.getElementById('btnCatalog');
    const btnAbout = document.getElementById('btnAbout');
    const catalogSection = document.getElementById('catalogSection');
    const contentAbout = document.getElementById('contentAbout');

    btnCatalog.addEventListener('click', () => {
      catalogSection.style.display = 'block';      // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥
      contentAbout.style.display = 'none';         // —Å–∫—Ä—ã–≤–∞–µ–º "–û –Ω–∞—Å"
      btnCatalog.style.background = '#8e44ad';     // –≤—ã–¥–µ–ª—è–µ–º –∫–Ω–æ–ø–∫—É
      btnCatalog.style.color = '#fff';
      btnAbout.style.background = '#ddd';
      btnAbout.style.color = '#000';
    });

    btnAbout.addEventListener('click', () => {
      catalogSection.style.display = 'none';       // —Å–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥
      contentAbout.style.display = 'block';        // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–û –Ω–∞—Å"
      btnAbout.style.background = '#8e44ad';       // –≤—ã–¥–µ–ª—è–µ–º –∫–Ω–æ–ø–∫—É
      btnAbout.style.color = '#fff';
      btnCatalog.style.background = '#ddd';
      btnCatalog.style.color = '#000';
    });

    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –∏ –≤—ã–¥–µ–ª—è–µ–º –∫–Ω–æ–ø–∫—É
    btnCatalog.click();

    // === –ö–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Google Sheets (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ===
    const sheetId = "1uvZDDq7y3D73InwHYQ4vKqmhHXGtK9KjdRcVXzm5KAk"; // ID —Ç–∞–±–ª–∏—Ü—ã
    const sheetName = "–õ–∏—Å—Ç1";
    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?sheet=${sheetName}`;

    let products = [];

    fetch(url)
      .then(res => res.text())
      .then(rep => {
        const jsonData = JSON.parse(rep.substr(47).slice(0, -2));
        const rows = jsonData.table.rows;
        products = rows.map(row => {
          const cells = row.c;
          return {
            category: cells[0]?.v || "",
            subcategory: cells[1]?.v || "",
            name: cells[2]?.v || "",
            description: cells[3]?.v || "",
            price: cells[4]?.v || "",
            photo: cells[5]?.v || ""
          };
        });

        fillCategoryOptions();
        renderProducts(products);
      })
      .catch(err => {
        document.getElementById('products').innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</p>";
        console.error(err);
      });

    function fillCategoryOptions() {
      const categorySelect = document.getElementById("categorySelect");
      const categories = [...new Set(products.map(p => p.category).filter(c => c))].sort();

      categories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
      });

      categorySelect.addEventListener("change", () => {
        const selectedCat = categorySelect.value;
        fillSubcategoryOptions(selectedCat);
        filterAndRender();
      });
    }

    function fillSubcategoryOptions(category) {
      const subcategorySelect = document.getElementById("subcategorySelect");
      subcategorySelect.innerHTML = '<option value="">–í—Å–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';

      if (!category) {
        subcategorySelect.disabled = true;
        filterAndRender();
        return;
      }

      subcategorySelect.disabled = false;
      const subcategories = [...new Set(products
        .filter(p => p.category === category)
        .map(p => p.subcategory)
        .filter(sc => sc))].sort();

      subcategories.forEach(subcat => {
        const option = document.createElement("option");
        option.value = subcat;
        option.textContent = subcat;
        subcategorySelect.appendChild(option);
      });

      subcategorySelect.addEventListener("change", filterAndRender);
    }

    function filterAndRender() {
      const selectedCat = document.getElementById("categorySelect").value;
      const selectedSubcat = document.getElementById("subcategorySelect").value;

      let filtered = products;

      if (selectedCat) {
        filtered = filtered.filter(p => p.category === selectedCat);
      }
      if (selectedSubcat) {
        filtered = filtered.filter(p => p.subcategory === selectedSubcat);
      }

      renderProducts(filtered);
    }

    function renderProducts(items) {
      const container = document.getElementById("products");
      container.innerHTML = "";

      if (items.length === 0) {
        container.innerHTML = "<p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>";
        return;
      }

      items.forEach(item => {
        const block = document.createElement("div");
        block.className = "product";

        block.innerHTML = `
          <img src="${item.photo}" alt="${item.name}" />
          <h2>${item.name}</h2>
          <p><strong>${item.price} ‚ÇΩ</strong></p>
          <p>${item.description}</p>
          <p><em>${item.category} / ${item.subcategory}</em></p>
          <a href="https://wa.me/79161234567?text=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ,%20–∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç%20—Ç–æ–≤–∞—Ä:%20${encodeURIComponent(item.name)}" target="_blank" class="whatsapp-button">–ù–∞–ø–∏—Å–∞—Ç—å –≤ WhatsApp</a>
        `;

        container.appendChild(block);
      });
    }
  </script>

</body>
</html>